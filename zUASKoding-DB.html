<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PSAS by:SALIM</title>
<style>
/* Tambahkan ini di bagian CSS */
#toggleNumberList {
    margin-top: 10px;
}

.number-list.hide {
    display: none;
}

/* Tambahkan ini di bagian CSS */
.num-btn.answered {
    background-color: #10b981; /* Hijau */
    color: white;
    border-color: #059669;
}

.num-btn.unanswered {
    background-color: #d1d5db; /* Abu-abu */
    color: #333;
    border-color: #9ca3af;
}

/* ===== GLOBAL ===== */
body { margin:0; font-family:'Poppins',sans-serif; background:#e2e8f0; color:#333; }
.container { max-width:900px; margin:auto; padding:20px; }
.card { background:#fff; padding:25px; border-radius:15px; box-shadow:0 8px 20px rgba(0,0,0,0.1); transition:0.3s; }
.hide { display:none; }
h2,h3{margin-bottom:15px;}
input,textarea{border:1px solid #ccc; border-radius:8px; padding:10px; font-size:15px;}
#kelas {
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background-color: #f9f9f9;
    width: 100%;
    max-width: 200px;
    cursor: pointer;
}


/* ===== BUTTONS ===== */
.btn{ padding:10px 20px; border:none; border-radius:10px; cursor:pointer; font-size:15px; margin:5px; transition:0.2s; }
.btn-primary{ background:#4f46e5; color:#fff; }
.btn-primary:hover{ background:#4338ca; }
.btn-secondary{ background:#6b7280; color:#fff; }
.btn-secondary:hover{ background:#4b5563; }
.btn-danger{ background:#ef4444; color:#fff; }
.btn-danger:hover{ background:#b91c1c; }
.btn:active{ transform:scale(0.93); transition:0.1s; }
.btn:hover{ box-shadow:0 4px 10px rgba(0,0,0,0.15); }

.number-list { margin-bottom:20px; display:flex; flex-wrap:wrap; gap:5px; }
.num-btn { width:40px; height:40px; display:flex; justify-content:center; align-items:center; background:#d1d5db; border-radius:8px; font-weight:bold; cursor:pointer; border:2px solid transparent; transition:0.2s; }
.num-btn:hover{ background:#9ca3af; }
.num-active { background:#4f46e5; color:#fff; border-color:#4338ca; }

.slide-left{ animation: slideLeft 0.3s ease; }
@keyframes slideLeft{ from{opacity:0; transform:translateX(40px);} to{opacity:1; transform:translateX(0);} }
.slide-right{ animation: slideRight 0.3s ease; }
@keyframes slideRight{ from{opacity:0; transform:translateX(-40px);} to{opacity:1; transform:translateX(0);} }

@media(max-width:600px){ .number-list{justify-content:center;} .btn{width:100%; margin:5px 0;} }
</style>
</head>
<body>
<div class="container">

<!-- HALAMAN AWAL -->
<div id="startPage" class="card">
    <h2 style="display: flex; align-items: center;">
        <img src="logo.png" alt="Logo" style="width: 50px; height: 50px; margin-right: 10px;">
        SMP Negeri 3 Babat
    </h2>
    <h3 align="center">Penilaian Sumatif Akhir Semester<br>Tahun Pelajaran 2025/2026</h3>

	<div style="background-color: papayawhip; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); width: 80%; max-width: 600px; text-align: justify; margin: 20px auto;">
        <span style="font-weight: bold; color: #0066cc;">Mata Pelajaran:</span> <b>Koding / KKA</b><br>
        <span style="font-weight: bold; color: #0066cc;">Guru Pengampu:</span><br>
        1) Salim Ubaidillah, S.Kom.<br>
        2) M. Izzul Haq, S.Pd.<br>
        <span style="font-weight: bold; color: #0066cc;">Hari & Tanggal:</span><br>Senin, 1 Desember 2025<br>
        <span style="font-weight: bold; color: #0066cc;">Waktu:</span> 30 Menit
    </div>

<div style="background-color: lightblue; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); width: 80%; max-width: 600px; text-align: justify; margin: 20px auto;">
    <label for="nama">Nama:</label><br>
    <input id="nama" type="text" placeholder="Masukkan nama" style="width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;"><br>
    <div id="nameError" style="color: red; font-size: 12px; display: none;">Nama harus diisi!</div><br>

    <label for="kelas">Kelas:</label><br>
    <select id="kelas" style="width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;">
        <option value="" disabled selected>Pilih Kelas</option>
        <option value="7A">7A</option>
        <option value="7B">7B</option>
        <option value="7C">7C</option>
        <option value="7D">7D</option>
    </select><br>
	<div id="classError" style="color: red; font-size: 12px; display: none;">Kelas harus dipilih!</div>
</div>

    
	
	
    <div style="background-color: lightcyan; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); width: 80%; max-width: 600px; text-align: justify; margin: 20px auto;">
        <h3 style="text-align: center; color: #333;">Peraturan Sumatif</h3>
        <ol style="font-size: 16px; color: #555; line-height: 1.6;">
  <li>Saya berjanji akan mengerjakan sendiri dan tidak mencontek.</li>
  <li>Saya memahami sumatif hanya bisa dikerjakan sekali.</li>
  <li>Saya memahami jika keluar aplikasi maka jawaban tidak bisa tersimpan.</li>
</ol>

        <p style="font-style: italic; color: #888; font-size: 16px; line-height: 1.6;">Pastikan kamu sudah siap sebelum memulai sumatif ini. Berdoalah<br>Good Luck!!!</p>
  	</div>

    <div>
        <input type="checkbox" id="agreeCheckbox">
        <label for="agreeCheckbox" style="font-size: 14px; color: #555;">
            Saya setuju dan memahami aturan tersebut
        </label>
    </div>
    <div id="agreeError" style="color: red; font-size: 12px; display: none;">Anda harus mencentang persetujuan!</div><br>

    <button id="startButton" class="btn btn-primary" onclick="mulaiKuis()">Mulai Kuis</button>
</div>


<!-- HALAMAN KUIS -->
<div id="quizPage" class="hide">
  <div class="card">
    <h2>PSAS Koding / KKA</h2>
    <p>Waktu tersisa: <span id="timer">30:00</span></p>
    <p>Total soal: <b><span id="totalSoal"></span></b></p>
    
    <button id="toggleNumberList" class="btn btn-secondary" onclick="toggleNumberList()">Sembunyikan Nomor Soal</button>
    
    <div class="number-list" id="numberList"></div>
  </div>
  
  <br>
  <div id="questionCard" class="card"></div>
  <br>
  <div style="display: flex; justify-content: space-between; gap: 10px;">
    <button class="btn btn-secondary" id="btn-sebelumnya" onclick="nav(-1)" disabled>Sebelumnya</button>
    <button class="btn btn-danger" id="btn-selesai" style="display: none;" onclick="selesaiKuis()">Selesai</button>
    <button class="btn btn-secondary" id="btn-selanjutnya" onclick="nav(1)">Selanjutnya</button>
  </div>
</div>

<!-- HALAMAN SELESAI -->
<div id="donePage" class="card hide">
  <h2>Terima kasih</h2>
  <p>Kamu telah mengerjakan dan tidak dapat mengulangi lagi. Semoga Sukses!!!</p>

  <!-- Tambahan: tampilan skor -->
  <div style="margin-top:20px; padding:15px; background:#f3f4f6; border-radius:10px;">
    <h3>Hasil Kamu</h3>
    <p><strong>Nama:</strong> <span id="finalName">-</span></p>
    <p><strong>Kelas:</strong> <span id="finalClass">-</span></p>
    <p><strong>Skor:</strong> <span id="finalScore">0</span> / <span id="maxScore">0</span></p>
    <p><strong>Persentase:</strong> <span id="percentScore">0%</span></p>
    <p id="noteScore" style="font-style:italic; color:#555; margin-top:10px;"></p>
  </div>

  <!-- <div style="margin-top:15px;">
    <button class="btn btn-primary" onclick="location.reload()">Kembali ke Halaman Awal</button>
  </div> -->
</div>

<!-- Firebase -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        databaseURL: "https://uas25-smp3-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };

    const app = initializeApp(firebaseConfig);
    window.db = getDatabase(app);

    window.saveToFirebase = function(path, data) {
        return set(ref(window.db, path), data);
    };
    window.updateFirebase = function(path, data) {
        return update(ref(window.db, path), data);
    };
</script>


<script>
// ================= GLOBAL DB (tidak lagi localStorage) =================
let DB = { nama: "", kelas: "", jawaban: {}, skor: 0 };


// ================= HITUNG SKOR MAKSIMAL =================
function computeMaxScore() {
    let max = 0;
    for (let i = 0; i < questions.length; i++) {
        const q = questions[i];
        if (q.type === "pg" || q.type === "pgk") max += 2;
    }
    return max;
}


// ================= TOGGLE NOMOR SOAL =================
function toggleNumberList() {
    const numberListElement = document.getElementById("numberList");
    const toggleButton = document.getElementById("toggleNumberList");

    numberListElement.classList.toggle("hide");

    toggleButton.textContent = numberListElement.classList.contains("hide")
        ? "Tampilkan Nomor Soal"
        : "Sembunyikan Nomor Soal";
}


// ================= DATA SOAL =================
let pg = [ 
    { text:"Berikut ini pernyataan yang benar tentang apa yang dimaksud dengan algoritma adalah...",
      options:["Bahasa pemrograman khusus","Kumpulan instruksi acak","Urutan langkah sistematis untuk menyelesaikan masalah","Kode komputer"], answer:2 },
    { text:"Proses penulisan algoritma ke dalam bahasa yang dipahami komputer disebut...",
      options:["Writing","Pemrograman","Pengulangan","Percabangan"], answer:1 },
    { text:"Scratch merupakan bahasa pemrograman yang berbasis...",
      options:["Teks","Simbol","Blok visual","Alur logika"], answer:2 },
    { text:"Blok “move 10 steps” dalam scratch digunakan untuk...",
      options:["Menghapus sprite","Mengubah kostum","Menggerakan sprite","Menampilkan suara"], answer:2 },
    { text:"Simbol belah ketupat dalam flowchart digunakan untuk menyatakan...",
      options:["Input/output","Proses","Kondisi","Awal/akhir"], answer:2 },
    { text:"Dalam Scratch, sprite adalah...",
      options:["Latar belakang program","Kumpulan blok","Karakter atau objek dalam proyek","Nama variabel"], answer:2 },
    { text:"Fungsi dari blok “if on edge, bounce” adalah...",
      options:["Menyembunyikan sprite","Menghapus latar","Memantulkan sprite dari tepi","Memulai skrip"], answer:2 },
    { text:"Blok “say hello! For 2 seconds” digunakan untuk...",
      options:["Menyapa pengguna selama 2 detik","Mengubah sprite","Mengubah ukuran sprite","Menambah suara"], answer:0 },
    { text:"Jika kalian ingin sprite berbicara saat diklik maka blok yang digunakan adalah...",
      options:["When green flag clicked","When this sprite clicked","Repeat until","Play sound"], answer:1 },
    { text:"Fungsi dari blok “repeat 10” adalah...",
      options:["Mengulang selamanya","Mengulang sebanyak 10 kali","Mengulang hingga kondisi benar","Menyimpan variabel"], answer:1 },
    { text:"Dalam Scratch, broadcast digunakan untuk...",
      options:["Menggerakan sprite","Menyimpan data","Mengirim pesan antar sprite","Mengubah ekspresi"], answer:2 },
    { text:"Blok yang digunakan untuk membuat percabangan adalah...",
      options:["Forever","Glide","If...then","Broadcast"], answer:2 },
    { text:"Variabel digunakan untuk...",
      options:["Mengganti suara","Menyimpan nilai data","Menampilkan sprite","Mengubah warna"], answer:1 },
    { text:"Blok “join [apple] [banana]” menghasilkan...",
      options:["Applebanana","Bananaapple","Apple banana","Banana apple"], answer:0 },
    { text:"Untuk memutar suara sampai selesai, kalian dapat menggunakan blok...",
      options:["Play sound until done","Start sound","Stop all sounds","Say for 2 seconds"], answer:0 }
];

let pgk = [
    {
        text:"Berikut ini yang merupakan pengertian yang benar tentang algoritma adalah...",
        options:["Urutan langkah sistematis untuk menyelesaikan masalah","Kumpulan instruksi acak",
        "Proses penyusunan kode komputer secara langsung","Kumpulan instruksi yang dapat dieksekusi oleh komputer"],
        answer:[0,3]
    },
    {
        text:"Dalam Scratch, sprite dapat memiliki berbagai fungsi...",
        options:["Sprite berfungsi sebagai objek atau karakter","Sprite digunakan untuk menyimpan variabel",
        "Sprite dapat bergerak & berinteraksi","Sprite berfungsi sebagai latar"],
        answer:[0,2]
    },
    {
        text:"Fungsi blok repeat & if...then adalah...",
        options:["Repeat untuk mengulang beberapa kali","Repeat untuk tanpa batas",
        "If...then memeriksa kondisi","If...then untuk menghentikan perulangan"],
        answer:[0,2]
    },
    {
        text:"Blok broadcast digunakan untuk...",
        options:["Mengirim pesan antar sprite","Mengubah ekspresi","Memulai skrip","Menyimpan data"],
        answer:[0,2]
    },
    {
        text:"Fungsi blok say & play sound adalah...",
        options:["Say untuk menampilkan teks","Say untuk memutar suara",
        "Play sound untuk memutar hingga selesai","Play sound untuk mengubah tampilan"],
        answer:[0,2]
    }
];

let essay = [
    { text:"Mengapa pengelolaan data di era digital penting?" },
    { text:"Jika lampu mati, langkah apa yang kalian lakukan?" },
    { text:"Bagaimana variabel membantu dalam membuat game di Scratch?" },
    { text:"Urutkan langkah mencuci tangan berikut..." },
    { text:"Apa fungsi blok repeat until dan contohnya?" }
];


// ================= RANDOM =================
function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

shuffle(pg);
shuffle(pgk);
shuffle(essay);

const questions = [
    ...pg.map(q => ({ type:"pg", ...q })),
    ...pgk.map(q => ({ type:"pgk", ...q })),
    ...essay.map(q => ({ type:"essay", ...q }))
];


// ================= GLOBAL =================
let curr = 0;
let waktu = 30 * 60;
let timerInterval;


// ================= MULAI KUIS =================
function mulaiKuis() {
    let valid = true;

    nameError.style.display = "none";
    classError.style.display = "none";
    agreeError.style.display = "none";

    if (!nama.value) { nameError.style.display = "block"; valid = false; }
    if (!kelas.value) { classError.style.display = "block"; valid = false; }
    if (!agreeCheckbox.checked) { agreeError.style.display = "block"; valid = false; }

    if (!valid) return;

    DB.nama = nama.value;
    DB.kelas = kelas.value;

    saveToFirebase("jawaban/" + DB.kelas + "/" + DB.nama, DB);

    startPage.classList.add("hide");
    quizPage.classList.remove("hide");

    loadNumberList();
    loadQuestion(curr);
    mulaiTimer();
}


// ================= LOAD NOMOR SOAL =================
function loadNumberList() {
    totalSoal.textContent = questions.length;
    numberList.innerHTML = "";

    for (let i = 0; i < questions.length; i++) {
        let btn = document.createElement("div");
        btn.className = "num-btn";
        btn.textContent = i + 1;

        if (DB.jawaban[i] !== undefined && DB.jawaban[i] !== "") {
            btn.classList.add("answered");
        } else {
            btn.classList.add("unanswered");
        }

        btn.onclick = () => { curr = i; loadQuestion(curr); };

        numberList.appendChild(btn);
    }

    updateActiveNumber();
}

function updateActiveNumber() {
    const btns = document.querySelectorAll(".num-btn");
    btns.forEach((b, i) => { b.classList.toggle("num-active", i === curr); });
}


// ================= SIMPAN JAWABAN KE FIREBASE =================
function simpanJawaban(no, value) {
    DB.jawaban[no] = value;

    updateFirebase("jawaban/" + DB.kelas + "/" + DB.nama + "/jawaban", DB.jawaban);

    loadNumberList();
}

function updatePGK(no) {
    const boxes = document.querySelectorAll(`input[name='q${no}']`);
    const selected = [];
    boxes.forEach(b => { if (b.checked) selected.push(Number(b.value)); });
    simpanJawaban(no, selected);
}


// ================= TAMPILKAN SOAL =================
function loadQuestion(i) {
    const q = questions[i];
    let html = `<h3>${i + 1}. ${q.text}</h3><br>`;

    if (q.type === "pg") {
        q.options.forEach((o, idx) => {
            html += `<label><input type="radio" name="q${i}" value="${idx}" 
                ${DB.jawaban[i] == idx ? "checked" : ""} 
                onchange="simpanJawaban(${i}, ${idx})"> ${o}</label><br>`;
        });

    } else if (q.type === "pgk") {
        q.options.forEach((o, idx) => {
            const checked = DB.jawaban[i]?.includes(idx) ? "checked" : "";
            html += `<label><input type="checkbox" name="q${i}" value="${idx}" 
                ${checked} onchange="updatePGK(${i})"> ${o}</label><br>`;
        });

    } else {
        html += `<textarea rows="5" style="width:100%" 
            onkeyup="simpanJawaban(${i}, this.value)">${DB.jawaban[i] || ""}</textarea>`;
    }

    questionCard.innerHTML = html;

    updateActiveNumber();

    // tampilkan tombol
    if (curr === questions.length - 1) {
        btn-selesai.style.display = "inline-block";
        btn-selanjutnya.style.display = "none";
    } else {
        btn-selesai.style.display = "none";
        btn-selanjutnya.style.display = "inline-block";
    }

    btn-sebelumnya.style.display = curr === 0 ? "none" : "inline-block";
}


// ================= NAVIGASI =================
function nav(step) {
    curr += step;
    if (curr < 0) curr = 0;
    if (curr >= questions.length) curr = questions.length - 1;
    loadQuestion(curr);
}


// ================= TIMER =================
function mulaiTimer() {
    timerInterval = setInterval(() => {
        waktu--;
        let m = Math.floor(waktu / 60), s = waktu % 60;
        timer.textContent = `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
        if (waktu <= 0) selesaiKuis();
    }, 1000);
}


// ================= CEK SEMUA JAWABAN =================
function checkAllAnswered() {
    for (let i = 0; i < questions.length; i++) {
        const q = questions[i];
        const j = DB.jawaban[i];

        if (q.type === "pg" && (j === undefined)) return false;
        if (q.type === "pgk" && (!j || j.length === 0)) return false;
        if (q.type === "essay" && (!j || j.trim() === "")) return false;
    }
    return true;
}


// ================= HITUNG SKOR =================
function hitungSkor() {
    let skor = 0;

    for (let i = 0; i < questions.length; i++) {
        const q = questions[i];
        const j = DB.jawaban[i];

        if (q.type === "pg" && j == q.answer) skor += 2;

        if (q.type === "pgk" && Array.isArray(j) &&
            j.length === q.answer.length &&
            q.answer.every(x => j.includes(x))) {
            skor += 2;
        }
    }

    DB.skor = skor;

    updateFirebase("jawaban/" + DB.kelas + "/" + DB.nama, { skor: skor });

    return skor;
}


// ================= SELESAI KUIS =================
function selesaiKuis() {
    if (!checkAllAnswered()) {
        alert("Pastikan semua soal sudah dijawab.");
        return;
    }

    if (!confirm("Yakin mengumpulkan?")) return;

    clearInterval(timerInterval);
    hitungSkor();

    finalName.textContent = DB.nama;
    finalClass.textContent = DB.kelas;

    const max = computeMaxScore();
    finalScore.textContent = DB.skor;
    maxScore.textContent = max;

    percentScore.textContent = Math.round((DB.skor / max) * 100) + "%";

    const percent = (DB.skor / max) * 100;
    if (percent >= 80) noteScore.textContent = "Keren! Nilai kamu sangat baik.";
    else if (percent >= 60) noteScore.textContent = "Bagus! Tapi masih bisa ditingkatkan.";
    else noteScore.textContent = "Tetap semangat! Pelajari lagi ya.";

    quizPage.classList.add("hide");
    donePage.classList.remove("hide");
}
</script>


</body>
</html>
